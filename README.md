# DevOpsLab

## Terraform
execute ``set-pwsh-auth-terraform.ps1`` powershell script to set all env variables

```terraform init --backend=true -backend-config=".\backend.tfvars"```

```terraform plan --out="xyz.plan" --var-file=".\terraform.tfvars" --var-file=".\auth.tfvars"```

## Container

### Python API container

#### Build

```podman build --tag angelusgi/apidemo:0.0.3 --file py_app/2_myApi/Dockerfile```

#### Push to Docker Hub
```podman login <docker-registry-name> --username <your-user-name> --password <your-user-name>```

```podman push docker://angelusgi/apidemo:0.0.3```

#### Execute

```podman run --publish 8089:80 docker://angelusgi/apidemo:0.0.3```


### Locust container

#### Build

```podman build --tag angelusgi/locust_test:0.0.4 --file py_app/3_perfTest/Dockerfile```

#### Push to Docker Hub
```podman login <docker-registry-name> --username <your-user-name> --password <your-user-name>```

```podman push docker://angelusgi/locust_test:0.0.4```

#### Execute
Locust will save in ``/tmp/output`` all report files generated by the test as set in ``logfile`` ``csv`` ``html`` parameters in ``.locust.conf`` content.

To start the start you can run 
```sudo podman run --publish 8089:8089 -v /tmp/output:/tmp/locustoutput docker://angelusgi/locust_test:0.0.4```

## Locust

### Configuration file
example of ``.locust.conf`` content
```
locustfile = ./locustfile.py
users = 500
spawn-rate = 10
run-time = 5m
autoquit = 10
autostart = true
skip-log-setup = true
only-summary = true
processes = -1
loglevel = INFO
csv = /tmp/locustoutput/test
html = /tmp/locustoutput/test-report.html
logfile = /tmp/locustoutput/logs.txt
host = <host-fqnd-to-test>
```

